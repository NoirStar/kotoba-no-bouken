# ことばの冒険 (Kotoba no Bōken) - 프로젝트 계획서

## 🎯 프로젝트 개요

**ことばの冒険**은 2D 픽셀아트 "방(Room)" 안에서 NPC에게 직접 일본어로 말을 걸어 미션을 클리어하는 인터랙티브 일본어 학습 게임입니다.

### 핵심 컨셉
- 각 스테이지는 하나의 **방(Room)** — 편의점, 식당, 학교 등. 방 밖으로는 나갈 수 없음
- 방 안에 **NPC**(점원, 손님 등)가 있고, 플레이어 캐릭터를 **키보드/터치**로 픽셀 월드에서 조작
- NPC 근처로 가서 **마이크 버튼**을 누르고 실제 음성으로 일본어를 말하면:
  1. 🎤 캐릭터 머리 위에 마이크 아이콘이 표시
  2. 💬 STT로 인식된 텍스트가 대사창에 표시
  3. 🤖 근처 NPC가 AI로 생성된 일본어로 응답 (TTS 음성 + 대사창)
- 각 방마다 난이도별 **퀘스트 목록**이 있고, 퀘스트를 모두 깨면 **방 클리어**
- 모든 방을 클리어하면 **게임 클리어**

### 게임 플로우 예시
```
[편의점 Room]
  NPC: 점원, 손님A, 손님B

  플레이어가 키보드로 캐릭터를 점원 근처로 이동
    ↓
  마이크 버튼 클릭 (또는 Space키)
    ↓
  🎤 캐릭터 머리 위: 마이크 아이콘 표시
  플레이어: "すみません、おにぎりはどこですか？"
    ↓
  💬 대사창: "すみません、おにぎりはどこですか？"
    ↓
  🤖 점원 NPC (AI 응답): "おにぎりは、あちらの棚にございます"
  점원 머리 위: 💬 말풍선
    ↓
  ✅ 퀘스트 "おにぎりの場所を聞く" 클리어!
  📝 피드백: 문법 OK / 새 단어: 棚(たな) = 선반
```

---

## 🏠 Room (방) 시스템

### 방 목록 & 난이도

| Room | 이름 | 설명 | NPC |
|------|------|------|-----|
| 🏪 | コンビニ | 편의점 | 점원, 손님1~2 |
| 🍜 | レストラン | 식당 | 점원, 셰프, 손님 |
| 🏫 | 学校 | 학교 교실 | 선생님, 학생1~3 |
| 🏥 | 病院 | 병원 접수 | 접수원, 간호사, 환자 |
| 🏨 | ホテル | 호텔 로비 | 프론트, 벨보이, 투숙객 |
| 🚉 | 駅 | 기차역 | 역무원, 승객 |

### 퀘스트 난이도

각 방에는 **4단계 난이도**의 퀘스트가 존재:

| 난이도 | 이름 | 설명 | 예시 (편의점) |
|--------|------|------|---------------|
| ⭐ | EASY | 기초 인사/질문 | おにぎりを買う (주먹밥 사기) |
| ⭐⭐ | NORMAL | 일상 대화 | お弁当を温めてもらう (도시락 데워달라기) |
| ⭐⭐⭐ | HARD | 복잡한 요청/상황 | トイレを借りる (화장실 빌리기) |
| 💀 | HELL | 민망/당황 상황 | コンドームを買う (콘돔 사기) |

### 편의점 퀘스트 상세

**⭐ EASY**
| # | 퀘스트명 | 목표 | 핵심 표현 |
|---|---------|------|-----------|
| 1 | ラーメンを買おう | 라면 구매 | 「これをください」 |
| 2 | おにぎりを探そう | 주먹밥 위치 찾기 | 「〜はどこですか」 |
| 3 | 飲み物を選ぼう | 음료 고르기 | 「〜をお願いします」 |

**⭐⭐ NORMAL**
| # | 퀘스트명 | 목표 | 핵심 표현 |
|---|---------|------|-----------|
| 4 | お弁当を温めて | 도시락 전자렌지 | 「温めてもらえますか」 |
| 5 | 袋をもらおう | 봉투 요청 | 「袋をお願いします」 |
| 6 | ポイントカード | 포인트카드 | 「ポイントカードはありますか」 |

**⭐⭐⭐ HARD**
| # | 퀘스트명 | 목표 | 핵심 표현 |
|---|---------|------|-----------|
| 7 | トイレを借りる | 화장실 빌리기 | 「トイレをお借りしてもいいですか」 |
| 8 | 商品を返品する | 상품 반품 | 「返品したいのですが」 |
| 9 | 道を聞こう | 길 묻기 | 「〜への行き方を教えてください」 |

**💀 HELL**
| # | 퀘스트명 | 목표 | 핵심 표현 |
|---|---------|------|-----------|
| 10 | 恥ずかしい買い物 | 콘돔 사기 😅 | 「あの...これを...ください」(소곤소곤) |
| 11 | クレームを入れる | 클레임 넣기 | 「店長を呼んでいただけますか」 |
| 12 | ナンパに対応する | 헌팅 대처 | 「結構です」「ちょっと...」 |

---

## 🎮 조작법

| 입력 | 동작 |
|------|------|
| ← → ↑ ↓ / WASD | 캐릭터 이동 |
| Space / 마이크 버튼 | 음성 입력 시작/종료 |
| Enter | 텍스트 입력 전송 |
| Tab | 입력 모드 전환 (음성 ↔ 텍스트) |
| E | 근처 NPC/오브젝트 상호작용 |
| Esc | 퀘스트 목록 토글 |

---

## 🛠 기술 스택

| 영역 | 기술 |
|------|------|
| 프레임워크 | React 19 + TypeScript |
| 빌드 도구 | Vite |
| 게임 엔진 | Phaser 3 (2D 픽셀아트 렌더링) |
| AI | OpenAI GPT-4o (NPC 대화 + 문법 피드백) |
| 음성 입력 | Web Speech API (STT) |
| 음성 출력 | Web Speech API (TTS, 일본어) |
| 상태 관리 | Zustand |
| UI 컴포넌트 | shadcn/ui + Tailwind CSS |
| 배포 | Vercel |

---

## 📁 프로젝트 구조

```
kotoba-no-bouken/
├── api/
│   └── chat.ts                  # Vercel serverless: AI NPC 대화
├── public/
│   └── assets/
│       ├── sprites/             # 캐릭터 스프라이트시트
│       ├── tilesets/            # 타일셋 이미지
│       └── audio/               # 효과음/BGM
├── src/
│   ├── main.tsx                 # 앱 엔트리
│   ├── App.tsx                  # 라우팅/레이아웃
│   ├── index.css                # 글로벌 스타일
│   ├── game/
│   │   ├── PhaserGame.tsx       # React ↔ Phaser 브릿지 컴포넌트
│   │   ├── config.ts            # Phaser 게임 설정
│   │   ├── EventBridge.ts       # React-Phaser 이벤트 통신
│   │   ├── scenes/
│   │   │   ├── BootScene.ts     # 에셋 로딩
│   │   │   ├── ConbiniScene.ts  # 편의점 Room
│   │   │   └── UIScene.ts       # 게임 내 UI 오버레이 (대사창/마이크 아이콘)
│   │   ├── sprites/
│   │   │   ├── Player.ts        # 플레이어 캐릭터 (4방향 이동)
│   │   │   └── NPC.ts           # NPC 캐릭터 (AI 대화 가능)
│   │   └── objects/
│   │       └── InteractableItem.ts  # 상호작용 오브젝트 (상품 등)
│   ├── components/
│   │   ├── ui/                  # shadcn/ui 컴포넌트
│   │   ├── game/
│   │   │   ├── GameContainer.tsx    # 게임 화면 래퍼
│   │   │   ├── InputPanel.tsx       # 텍스트/음성 입력 패널
│   │   │   ├── DialogBox.tsx        # NPC 대사창
│   │   │   └── QuestPanel.tsx       # 퀘스트 목록/진행도
│   │   ├── room/
│   │   │   ├── RoomSelect.tsx       # 방 선택 화면
│   │   │   └── RoomClear.tsx        # 방 클리어 연출
│   │   ├── feedback/
│   │   │   ├── GrammarFeedback.tsx  # 문법 피드백 표시
│   │   │   └── VocabCard.tsx        # 새 단어 카드
│   │   └── layout/
│   │       └── GameLayout.tsx
│   ├── services/
│   │   ├── aiService.ts         # AI NPC 대화 API 호출
│   │   ├── speechService.ts     # STT/TTS 서비스
│   │   └── questService.ts      # 퀘스트 판정 로직
│   ├── stores/
│   │   ├── gameStore.ts         # 게임 전체 상태 (현재 방, 위치 등)
│   │   ├── dialogStore.ts       # 대화 기록/현재 대사
│   │   └── questStore.ts        # 퀘스트 진행 상태
│   ├── types/
│   │   ├── game.ts              # 게임 관련 타입
│   │   └── room.ts              # Room/Quest/NPC 타입
│   ├── data/
│   │   └── rooms/
│   │       └── conbini.ts       # 편의점 Room 데이터 (NPC, 퀘스트, 맵)
│   ├── hooks/
│   │   ├── useGameBridge.ts     # React ↔ Phaser 통신 훅
│   │   └── useSpeech.ts         # 음성 입출력 훅
│   └── lib/
│       └── utils.ts
├── tests/
│   └── setup.ts
└── api-dev-server.mjs           # 로컬 개발용 AI API 서버
```

---

## 🧠 AI NPC 대화 시스템

### 대화 파이프라인
```
플레이어가 NPC 근처로 이동
    ↓
마이크 버튼 클릭 → 🎤 캐릭터 머리 위 마이크 아이콘
    ↓
[Web Speech API STT] → 일본어 텍스트 변환
    ↓
💬 플레이어 대사창에 표시
    ↓
[AI API 호출]
  - 현재 Room 정보
  - 대화 상대 NPC 정보 (이름, 역할, 성격)
  - 대화 맥락 (이전 대화 기록)
  - 활성 퀘스트 목록
  - 플레이어 레벨
    ↓
AI 응답:
{
  npcReply: string          // NPC의 일본어 대사
  npcReplyReading: string   // 후리가나 포함 읽기
  translation: string       // 한국어 번역
  questProgress: {          // 퀘스트 진행 판정
    questId: string | null
    completed: boolean
    hint?: string
  }
  feedback: {               // 문법 피드백
    isNatural: boolean
    corrections?: string[]
    betterExpression?: string
    newVocab?: { word: string; reading: string; meaning: string }[]
  }
}
    ↓
🤖 NPC 대사창 + TTS 음성 출력
📝 피드백 표시
✅ 퀘스트 진행 업데이트
```

### NPC 성격 System Prompt 예시
```
당신은 일본 편의점 점원 "田中さん"입니다.
- 20대 여성, 밝고 친절한 성격
- 정중한 경어(敬語)를 사용
- 편의점 업무에 대해 잘 알고 있음
- 플레이어가 일본어를 잘 못하면 천천히/쉽게 말해줌

【현재 상황】
- 장소: コンビニ (편의점)
- 위치: レジ (카운터)
- 시간: 낮

【활성 퀘스트】
- ラーメンを買おう (라면 구매) - 미완료
- お弁当を温めて (도시락 데우기) - 미완료

반드시 일본어로만 대화하세요.
자연스러운 편의점 점원처럼 행동하세요.
```

---

## 🎨 아트 스타일

- **타일 크기**: 32×32 (픽셀아트)
- **방 크기**: 16×12 타일 (512×384 게임 해상도, 2x 스케일 → 1024×768 표시)
- **캐릭터**: 32×48 스프라이트, 4방향 × 4프레임 보행
- **NPC 상태 아이콘**: 머리 위에 표시
  - 🎤 말하는 중 (마이크)
  - 💬 NPC 응답 중 (말풍선)
  - ❗ 퀘스트 있음
  - ✅ 퀘스트 완료
- **MVP**: 컬러 도형 프로토타입 → 후에 픽셀아트 교체

---

## 📋 개발 단계

### Phase 1: MVP (현재)
- [x] 프로젝트 세팅
- [ ] Phaser 게임 기본 구조 (React ↔ Phaser 브릿지)
- [ ] 편의점 Room 타일맵 (프로토타입 도형)
- [ ] 플레이어 캐릭터 4방향 이동 (키보드/WASD)
- [ ] NPC 배치 + 근접 감지 (interaction zone)
- [ ] 마이크 음성 입력 (STT) → 대사창 표시
- [ ] AI NPC 대화 API (OpenAI)
- [ ] NPC 응답 대사창 + TTS 음성 출력
- [ ] 캐릭터 머리 위 아이콘 (🎤/💬)
- [ ] 퀘스트 시스템 (편의점 EASY~HELL)
- [ ] 문법 피드백 표시
- [ ] 방 클리어 판정

### Phase 2: 추가 Room & 퀄리티
- [ ] 🍜 レストラン Room
- [ ] 🏫 学校 Room
- [ ] 픽셀아트 에셋 교체
- [ ] 효과음/BGM
- [ ] 방 선택 월드맵
- [ ] 전체 클리어 엔딩

### Phase 3: 소셜/고급
- [ ] 유저 인증 & 진행도 저장
- [ ] 리더보드 (클리어 시간/점수)
- [ ] 추가 Room (병원, 호텔, 역)

---

## 🔧 환경 설정

### 필수 환경 변수
```
OPENAI_API_KEY=your_openai_api_key
```

### 개발 서버
```bash
npm install
npm run dev      # Vite 프론트엔드
npm run api      # 로컬 AI API 서버
```
